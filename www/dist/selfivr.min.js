/*! selfivr2 - v0.1.0 - 2015-05-04
* http://open.org.kh
* Copyright (c) 2015 Open Institute */
function getTemplate(a,b){var c={},d="",e="<div class='bigtext'>{{bigtext}}</div>",f="<div class='smalltext'>{{smalltext}}</div>",g="<div class='choice-image'><img ng-src='img/{{image}}' /></div>";switch(c.onlyImage="<div class='only-image'><img ng-src='img/{{image}}' /></div>",c.onlyText="<div class='only-text'>{{bigtext}}</div>",c.smalltextImage=f+g,c.imageSmalltext=g+f,c.bigSmall=e+f,c.smallBig=f+e,"round"===b&&"large"!==a&&"image"!==a&&(a="large"),a){case"small-big":d=c.smallBig;break;case"big-small":d=c.bigSmall;break;case"text-image":d=c.smalltextImage;break;case"image-text":d=c.imageSmalltext;break;case"image":d=c.onlyImage;break;case"large":d=c.onlyText}return d}function getPath(){var a=window.location.pathname;return a="file://"+a.substr(a,a.length-10)+"sounds/"}angular.module("selfivr",["ionic","directives","player","ngCordova","datetime"]).config(["$ionicConfigProvider",function(a){a.views.maxCache(0),a.views.transition("none")}]).run(["$ionicPlatform","$player",function(a,b){a.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault()});var c=null;document.addEventListener("pause",function(){null!==b.current&&(c=b.current,b.stop())},!1),document.addEventListener("resume",function(){null!==c&&(b.current=c,c=null,b.play())},!1)}]).value("$global",{backColor:"red",textColor:"white",style:"small-big",shape:"rectangle"}).controller("StartupCtrl",["$scope","$timeout","$state","$ionicHistory","$ionicNavBarDelegate","$datetime","$ionicPopup",function(a,b,c,d,e,f,g){function h(){if(console.log("Preference is not set."),"absolute"===f.date.type){var a=new Date;k=(a.getMonth()+1).toString()+"/"+a.getDate().toString()+"/"+a.getFullYear().toString()}else if("relative"===f.date.type){for(o=f.date.valuelist,n=0;n<o.length;n++)if(o[n]["default"]===!0){k=o[n].value;break}}else k=f.date.start,p=f.date.ndays;switch(f.time.type){case"absolute":l="16:00:00";break;case"relative":for(o=f.time.valuelist,n=0;n<o.length;n++)if(o[n]["default"]===!0){l=o[n].value;break}break;case"fixed":l=f.time.start}"absolute"===f.date.type||"relative"===f.date.type?q().then(function(a){a?(m='{"time": "'+l+'", "date": "'+k+'", "ndays":'+p+', "link":"/page/", "datetype": "'+f.date.type+'", "timetype": "'+f.time.type+'"}',j.store(function(){},function(){},"selfivr-pref",m)):j.store(function(){},function(){},"selfivr-pref","no-reminder"),b(function(){c.go("page")},2e3)}):(m='{"time": "'+l+'", "date": "'+k+'", "ndays":'+p+', "link":"/page/", "datetype": "'+f.date.type+'", "timetype": "'+f.time.type+'"}',j.store(function(){},function(){},"selfivr-pref",m),b(function(){c.go("page")},2e3))}function i(a){console.log("Preference is already set: "+a),b(function(){c.go("page")},2e3)}var j,k,l,m,n,o,p=3,q=function(){var b=g.show({template:"នៅ​ពេល​អ្នក​បើក​កម្មវិធី​នេះ​ដំបូង អ្នក​នឹង​ឃើញ​សារ​មួយ​នេះ ដើម្បី​សួរនាំ​អំពី​ការ​រំឭក។ តើ​អ្នក​ចង់​បើក​កំណត់​ការ​រំឭក​ដែរ​ឬ​ទេ? អ្នក​អាច​បិទ​ឬ​បើក​វា​ពេល​ក្រោយ​បាន​នៅ​ក្នុង​ការ​កំណត់។",title:"កំណត់​ការ​រំឭក​ជា​លើក​ដំបូង",subTitle:"នេះ​បង្ហាញ​តែ​លើក​ដំបូង​ប៉ុណ្ណោះ",scope:a,buttons:[{text:"មិន​បើក​ទេ",type:"button-assertive"},{text:"<b>សូម​បើក​វា</b>",type:"button-positive",onTap:function(){return!0}}]});return b};document.addEventListener("deviceready",function(){try{j=plugins.appPreferences,j.fetch(i,h,"selfivr-pref")}catch(a){console.error("Application preferences does not work in this environment. You should open this page in native mobile application.")}d.nextViewOptions({historyRoot:!0})})}]).controller("MainCtrl",["$scope","$player","$ionicHistory",function(a){a.exit=function(){navigator.notification.confirm("តើ​អ្នក​ពិត​ជា​ចង់​ចាកចេញ​មែន​ទេ?",function(){2==buttonIndex&&navigator.app.exitApp()},"ចាកចេញ",["បោះបង់","មែន"])}}]).controller("ReminderCtrl",["$scope","$player","$cordovaDatePicker","$datetime","$ionicHistory","$cordovaToast",function(a,b,c,d,e,f){function g(){}function h(){}function i(a){var b=a;return"number"==typeof a&&(b=10>a?"0"+a.toString():a.toString()),b}function j(a,b){var c,d=0;for(d;d<a.length;d++)if(a[d].value==b){c=a[d];break}return c}a.out=d;var k,l,m,n="",o="";l=e.backView()?e.backView().url:"",console.log(e.backView()),a.dt={day:"01",month:"01",year:"2015",hour:"16",minute:"00"},a.dd={},a.dd.toggle=!1,a.dd.ndays=3,"fixed"===d.date.type&&(a.dd.toggle=!0),"relative"===d.date.type&&(a.dt.day=d.date.valuelist[1],a.dd.ndays=0),"relative"===d.time.type&&(a.dt.hour=d.time.valuelist[0]),null!==b.current&&b.stop();try{k=plugins.appPreferences,k.fetch(function(b){if(console.log("Preference fetched: "+b),"no-reminder"!==b){var c=JSON.parse(b);switch(c.datetype){case"absolute":case"fixed":a.dd.toggle=!0;var e=new Date(c.date);a.dt.day=i(e.getDate()),a.dt.month=i(e.getMonth()+1),a.dt.year=e.getFullYear(),a.dd.ndays=c.ndays;break;default:a.dt.day=j(d.date.valuelist,c.date)}switch(c.timetype){case"absolute":case"fixed":var f=new Date(c.time);a.dt.hour=i(f.getHours()),a.dt.minute=i(f.getMinutes());break;default:a.dt.hour=j(d.time.valuelist,c.time)}}},function(){console.log("Datetime Preference is empty.")},"selfivr-pref")}catch(p){console.error("Application preferences does not work in this environment. You should open this page in native mobile application.")}a.setDate=function(){c.show({date:new Date,mode:"date"}).then(function(b){a.dt.day=i(b.getDate()),a.dt.month=i(b.getMonth()+1),a.dt.year=b.getFullYear().toString()})},a.setTime=function(){c.show({date:new Date,mode:"time"}).then(function(b){a.dt.hour=i(b.getHours()),a.dt.minute=i(b.getMinutes())})},a.setReminder=function(){if(a.dd.toggle===!0){var b;e.backView()&&(b=e.backView().title?e.backView().title:e.backView().viewId),n="relative"!==d.date.type?a.dt.month+"/"+a.dt.day+"/"+a.dt.year:a.dt.day.value,o="relative"!==d.time.type?a.dt.hour+":"+a.dt.minute+":00":a.dt.hour.value,m='{"time": "'+o+'", "date": "'+n+'", "ndays":'+a.dd.ndays+', "link":"'+l+'", "datetype": "'+d.date.type+'", "timetype": "'+d.time.type+'"}',console.log(m)}else m="no-reminder",f.showLongBottom("អ្នក​បាន​បិទ​ការ​រំឭក​ដោយ​ជោគជ័យ។");k.store(g,h,"selfivr-pref",m)}}]),angular.module("datetime",[]).value("$datetime",{date:{type:"absolute",start:"",ndays:0,valuelist:[{name:"ថ្ងៃ​ស្អែក",value:-1},{name:"ថ្ងៃ​នេះ",value:0,"default":!0},{name:"ម្សិល​មិញ",value:1}]},time:{type:"relative",start:"",valuelist:[{name:"30 នាទី​បន្ទាប់",value:30},{name:"60 នាទី​បន្ទាប់",value:60,"default":!0}]}}),angular.module("directives",[]).directive("siMedia",function(){return{restrict:"E",templateUrl:"player.html",compile:function(a){return a.addClass("player-wrapper"),function(a,b,c){a.image=c.image,a.hasImage=a.image?!0:!1}},controller:["$scope","$element","$attrs","$player",function(a,b,c,d){a.isPlaying=!1,null===d.current?c.sound&&(d["new"](c.sound),d.play(),a.isPlaying=!0):(d.stop(),c.sound&&(d["new"](c.sound),d.play(),a.isPlaying=!0)),a.play=function(){null!==c.sound&&null===d.current?(d["new"](c.sound),d.play(),a.isPlaying=!0):a.isPlaying||(d.play(),a.isPlaying=!0)},a.pause=function(){d.pause(),a.isPlaying=!1},a.stop=function(){d.stop(),a.isPlaying=!1}}]}}).directive("siPage",function(){return{restrict:"E",link:function(a,b){var c=b[0],d=c.children.length;c.className="page one-col center",5===d?(c.className="page two-cols center",c.children[2].style.flexBasis="100%"):d>6?c.className="page two-cols":d>3?c.className="page two-cols center":1===d?c.className+=" one":2===d?c.className+=" two":3===d&&(c.className+=" three")},controller:["$scope","$element","$attrs","$ionicHistory","$player",function(a,b,c,d,e){this.backColor=c.backColor,this.textColor=c.textColor,this.shape=c.shape,null===e.current?c.sound&&(e["new"](c.sound),e.play()):(e.stop(),c.sound&&(e["new"](c.sound),e.play()))}]}}).directive("siChoice",["$global","$rootScope","$compile",function(a,b,c){return{require:"^siPage",restrict:"E",scope:{},template:"<div ui-sref='page({pageId: url})' class='choice-content'></div>",link:function(b,d,e,f){b.bigtext=e.bigtext,b.smalltext=e.smalltext,b.url=e.url,b.image=e.image;var g=e.shape||f.shape||a.shape,h=(e.textColor||f.textColor||a.textColor,e.backColor||f.backColor||a.backColor),i=e.style||f.style||a.style,j=d.children();d.addClass("choice-item"),j.addClass(i),j.addClass(g),j.addClass(h),j.html(getTemplate(i,g)),c(j.contents())(b)}}}]),angular.module("player",[]).factory("$player",["$cordovaMedia",function(){return{current:null,"new":function(a){try{this.current=new Media(getPath()+a)}catch(b){console.error("Can't create new media object. No Media object available.")}},play:function(){null!==this.current&&this.current.play()},pause:function(){this.current.pause()},stop:function(){null!==this.current&&(this.current.stop(),this.current.release(),this.current=null)}}}]),angular.module("selfivr").config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b){b.when("","/"),b.when("/page","/page/"),a.state("start",{url:"/",templateUrl:"startup.html",controller:"StartupCtrl"}).state("page",{url:"/page/{pageId}",templateProvider:["$templateCache","$stateParams",function(a,b){var c=b.pageId,d="";return d=a.get(""===c?"main.html":b.pageId)}]}).state("reminder",{url:"/reminder",templateUrl:"reminder.html",controller:"ReminderCtrl"})}]);